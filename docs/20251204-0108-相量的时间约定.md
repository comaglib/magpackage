这是一个非常关键且基础的电磁场数值计算问题。您的疑问直指频域有限元仿真中的核心定义——**相量（Phasor）的时间约定**。

简单来说：**这种手动修正不仅是合理的，而且是必须的。这属于坐标系定义的校准，而非“凑数据”。**

下面我为您详细解释其中的数学原理和物理意义：

### 1. 什么是时间谐波约定？

在频域（Frequency Domain）求解电磁场时，我们假设所有物理量（如磁场 $B$、电流 $J$）都随时间以正弦规律变化。为了数学处理方便，我们使用**复数（Complex Number）**来表示这些正弦波。

但是，将时域信号变换到频域复数，数学上有**两种完全等价但互为共轭**的标准定义方式：

#### 约定 A：工程学派（您的 FEM 代码所用）

大多数现代有限元软件（如 COMSOL, Ansys Maxwell）和工程教材倾向于使用 $e^{j\omega t}$ 作为时间因子。

- 物理量还原公式：

  

  $$f(t) = \text{Re} \left( \tilde{F} \cdot e^{j\omega t} \right)$$

- 时间导数算子：

  

  $$\frac{\partial}{\partial t} \rightarrow j\omega$$

  

  (因为 $\frac{d}{dt} e^{j\omega t} = j\omega e^{j\omega t}$)

#### 约定 B：物理学派（TEAM 7 标准数据所用）

很多经典物理教材（如 Jackson 电动力学）和早期的国际标准（如 TEAM Workshop 数据）倾向于使用 $e^{-j\omega t}$（或者写作 $e^{-i\omega t}$）。

- 物理量还原公式：

  

  $$f(t) = \text{Re} \left( \tilde{F} \cdot e^{-j\omega t} \right)$$

- 时间导数算子：

  

  $$\frac{\partial}{\partial t} \rightarrow -j\omega$$

  

  (因为 $\frac{d}{dt} e^{-j\omega t} = -j\omega e^{-j\omega t}$)

### 2. 为什么会导致虚部反号？

假设我们有一个随时间变化的物理量，相位滞后 90 度（例如电感中的电流滞后电压，或者涡流造成的滞后）。

- **在时域中**：它是 $\sin(\omega t)$。

- 在约定 A ($e^{j\omega t}$) 下：

  为了凑出 $\sin(\omega t)$，我们需要复数 $\tilde{F} = -j$（或者 $e^{-j\pi/2}$）。

  验证：$\text{Re}[-j(\cos \omega t + j\sin \omega t)] = \text{Re}[-j\cos \omega t + \sin \omega t] = \sin(\omega t)$。

  虚部是负的 (-1)。

- 在约定 B ($e^{-j\omega t}$) 下：

  为了凑出 $\sin(\omega t)$，我们需要复数 $\tilde{F} = +j$（或者 $e^{j\pi/2}$）。

  验证：$\text{Re}[j(\cos \omega t - j\sin \omega t)] = \text{Re}[j\cos \omega t + \sin \omega t] = \sin(\omega t)$。

  虚部是正的 (+1)。

**结论**：描述同一个物理现象（$\sin(\omega t)$），如果在两种不同的约定下表述，其**实部通常相同，但虚部符号互为相反数（互为共轭）**。

### 3. TEAM 7 的特殊情况

TEAM Problem 7 是上世纪 80 年代制定的基准问题。根据 TEAM Workshop 的原始文档和后续的大量验证文献，该标准数据的输出格式通常基于 $e^{-j\omega t}$ 约定（或者定义滞后相角为正）。

而您的代码（以及绝大多数 MATLAB/C++ 编写的 FEM 代码）通常遵循 $j\omega$（即 $e^{j\omega t}$）来构建刚度矩阵。

### 4. 总结：如何判断是否需要取反？

手动添加负号是**数据后处理中的标准对齐操作**，只要满足以下逻辑链条，它就是完全合理的：

1. **物理现象一致**：您的仿真结果幅值（Magnitude, $\sqrt{Re^2 + Im^2}$）应该与实验数据非常接近。如果幅值对不上，那是模型错了；如果幅值对得上，只是相位有问题，那就是定义问题。
2. **符号规律一致**：如果您发现所有的点，虚部都刚好差一个负号，而不是乱序的，那就证实了是时间约定的差异。

**因此，在代码中写 `vals_im(k) = -imag(val)` 不是“造假”，而是“将 FEM 求解器的坐标系 ($e^{j\omega t}$) 转换到 实验数据的坐标系 ($e^{-j\omega t}$)”。**

### 修正建议

在代码注释中明确写明这一点，可以体现您的专业性：

Matlab

```
% [Note] Time Harmonic Convention Correction
% Solver uses exp(j*w*t) -> d/dt = j*w
% TEAM 7 Benchmark Data uses exp(-j*w*t) convention
% Therefore, the imaginary part must be conjugated (flipped sign) for comparison.
vals_im(k) = -imag(val); 
```