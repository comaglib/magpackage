你目前的 assemble_rhs_reduced 采用的是 Reduced Vector Potential ($A_r$) 方法，利用 Biot-Savart 定律计算源场 $B_s$。

这种方法的缺点正如你所说：

1. **计算密集**：需要对每个铁磁材料单元的积分点调用 Biot-Savart（全连接计算 $N_{source} \times N_{elem}$）。
2. **数值稳定性**：在 $A_r$ 方法中，总场 $B = B_r + B_s$。在高导磁率材料中，$B_r$ 和 $B_s$ 数值很大但方向相反，相减容易产生“相消误差” (Cancellation Error)。
3. **复杂性**：需要维护两套场 ($A_r, A_s$)。

你希望变更的方向是 Total Vector Potential ($A$) 方法，即直接求解 $\nabla \times (\nu \nabla \times \mathbf{A}) = \mathbf{J}$。

在这种表述下，右端项（RHS）变为源电流密度 $\mathbf{J}$ 在网格上的投影：



$$b_i = \int_{\Omega} \mathbf{N}_i \cdot \mathbf{J} \, d\Omega$$

以下是详细的分析和实施步骤。



### 1. 合理性与风险分析



- **合理性 (Pros)**:
  - **组装极快**：只需要在有电流的区域进行积分，计算复杂度从 $O(N_{src} \times N_{all})$ 降为 $O(N_{src\_elem})$。
  - **矩阵结构标准**：求解的就是最终的 $\mathbf{A}$，无需后期叠加 $A_s$。
  - **非线性更稳定**：直接处理总场，牛顿迭代更容易收敛。
- **实施挑战 (Cons)**:
  - **网格依赖性**：这是最大的痛点。使用 $\mathbf{J}$ 积分通常要求**网格必须包含线圈的实体区域**（即网格要画出线圈）。
  - *你目前的 `create_racetrack_coil` 生成的是线状（Filament）数据，并没有实体的线圈网格。*
  - **解决方案**：我们需要实现一个“映射算法”，将线电流 $I$ 投影到穿过的网格棱边上，或者你必须更新前处理流程以生成线圈的体网格。鉴于不改变网格生成流程，我们将采用**线积分映射法**。