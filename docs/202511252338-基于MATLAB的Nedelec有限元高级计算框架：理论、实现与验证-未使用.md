# 基于MATLAB的Nedelec有限元高级计算框架：理论、实现与验证

## 1. 电磁场有限元离散化的数学挑战与范式转变

计算电磁学（Computational Electromagnetics, CEM）在数值模拟领域占据着独特的地位，其核心难点在于麦克斯韦方程组（Maxwell's Equations）的内在几何结构与守恒律。与结构力学或流体动力学中常用的标量椭圆型问题不同，电磁场问题本质上是矢量波传播问题，对离散空间的物理性质有着更为苛刻的要求。在早期的有限元方法（FEM）研究中，研究人员倾向于直接沿用在结构力学中取得巨大成功的连续节点有限元（Nodal Elements），即基于拉格朗日（Lagrange）多项式系的基函数。然而，这种直接推广在处理矢量电磁场时遭遇了严重的理论障碍，最显著的表现便是“伪模态”（Spurious Modes）的污染。

### 1.1 节点有限元的失效机理与伪模态污染

在求解矢量波动方程时，电场 $\mathbf{E}$ 满足双旋度算子方程：

$$\nabla \times \frac{1}{\mu} \nabla \times \mathbf{E} - \omega^2 \epsilon \mathbf{E} = 0$$

该方程中的微分算子 $\nabla \times \nabla \times$ 具有一个无限维的零空间（Null Space），即所有的梯度场 $\nabla \phi$。这是因为对于任意标量势函数 $\phi$，恒有 $\nabla \times (\nabla \phi) = 0$。在物理上，这对应于静电场解。然而，当使用标准的连续节点有限元对计算域 $\Omega$ 进行离散时，所构建的近似空间 $V_h$ 是 $H^1(\Omega)^3$ 的子空间，而非物理上正确的 $H(\text{curl}; \Omega)$ 空间。节点元素强制要求电场的所有三个分量在单元界面上连续，这种过度的连续性约束破坏了离散算子的零空间结构。结果是，数值离散后的梯度场不再精确位于旋度算子的核空间内，导致对应的特征值不再是零，而是散落在非零物理谱中，形成了所谓的“谱污染” 3。

这种伪模态不仅在特征值问题中造成混淆，使得区分物理模式和非物理模式变得极其困难，而且在时域或频域的边值问题中也会导致数值解的收敛性退化，甚至收敛到错误的物理极限。为了解决这一根本性问题，必须引入一种新的离散范式，即寻找一种仅保证切向分量连续而允许法向分量不连续的有限元空间，从而正确模拟电磁场的物理边界条件和界面条件。

### 1.2 Nedelec元素的引入与$H(\text{curl})$空间

Jean-Claude Nédélec 在 20 世纪 80 年代提出的棱边有限元（Edge Elements），特别是针对单纯形（四面体、三角形）和长方体（六面体、矩形）网格构建的基函数族，彻底解决了上述问题。Nédélec 元素的核心思想是将自由度（Degrees of Freedom, DOFs）关联在网格的棱边（Edge）上，而非节点（Vertex）上。对于最低阶的 Nédélec 元素，每个棱边分配一个自由度，代表电场沿该棱边的切向投影积分 $\int_e \mathbf{E} \cdot d\mathbf{l}$ 5。

从泛函分析的角度来看，Nédélec 空间是 $H(\text{curl}; \Omega)$ 的共形子空间。$H(\text{curl}; \Omega)$ 定义为平方可积且其旋度也平方可积的矢量函数空间：

$$ H(\text{curl}; \Omega) = { \mathbf{v} \in [L^2(\Omega)]^3 : \nabla \times \mathbf{v} \in [L^2(\Omega)]^3 } $$

在该空间中，函数在跨越材料界面时，仅需满足切向连续性 $\mathbf{n} \times (\mathbf{E}_1 - \mathbf{E}_2) = 0$，这与麦克斯韦方程组在非均匀介质中的界面条件完全一致。更重要的是，Nédélec 元素能够精确表示梯度场，即对于离散标量空间 $S_h$ 中的任意函数 $p_h$，其梯度 $\nabla p_h$ 必然包含在离散矢量空间 $V_h$ 中。这一性质被称为“离散紧致性”或“精确序列性质”（Exact Sequence Property），它保证了离散旋度算子的核空间结构与连续算子一致，从而从根本上消除了伪模态 7。

### 1.3 离散微分形式与Whitney形式

Nédélec 元素与微分几何中的 Whitney 形式有着深刻的联系。Whitney 1-形式正是最低阶 Nédélec 基函数的几何表达。在四面体网格上，Whitney 形式提供了一种构造基函数的直接方法，利用重心坐标（Barycentric Coordinates）的线性组合来定义矢量场。这种构造不仅具有优美的几何解释，而且在计算上具有仿射不变性，极大地方便了在非结构化网格上的数值实现 8。

随着高阶有限元方法的发展，研究重点逐渐从最低阶元素转向高阶 $H(\text{curl})$ 元素。高阶元素能够提供更快的收敛速度（即 $p$-型或 $hp$-型有限元），特别是在处理电大尺寸问题时，能够有效控制色散误差（Dispersion Error）。然而，高阶 Nédélec 元素的基函数构造、自由度定义以及在 MATLAB 等平台上的高效实现，相比低阶元素要复杂得多，涉及勒让德（Legendre）多项式的正交化、分层基（Hierarchical Basis）的构建以及复杂的编号和定向管理 9。

本报告将深入探讨 Nédélec 四面体单元的理论基础，推导其基函数公式，阐述在 MATLAB 环境下基于矢量化思想的高效实现策略，并建立一套严格的验证体系，包括离散亥姆霍兹分解（Discrete Helmholtz Decomposition）和刚体模态分析，以确保数值计算的正确性与鲁棒性。

------

## 2. 四面体上的Nedelec基函数数学公式与推导

在三维非结构化网格中，四面体单元因其几何适应性而被广泛采用。构建四面体上的 Nédélec 基函数，首先需要建立稳健的局部坐标系。重心坐标系（Barycentric Coordinates）因其形式简洁且天然满足单纯形的几何约束，成为首选。

### 2.1 重心坐标系的几何构建

设四面体 $T$ 由四个顶点 $\mathbf{v}_1, \mathbf{v}_2, \mathbf{v}_3, \mathbf{v}_4$ 定义，其体积为 $V$。对于四面体内部任意一点 $\mathbf{x} = (x, y, z)^T$，其位置矢量可以唯一地表示为顶点的凸组合：

$$ \mathbf{x} = \sum_{i=1}^4 \lambda_i(\mathbf{x}) \mathbf{v}i, \quad \text{满足} \quad \sum{i=1}^4 \lambda_i = 1 $$

这里的系数 $\lambda_i$ 即为重心坐标。它们是关于空间坐标 $(x, y, z)$ 的线性函数，因此其梯度 $\nabla \lambda_i$ 是常矢量。几何上，$\lambda_i(\mathbf{x})$ 表示点 $\mathbf{x}$ 与顶点 $i$ 对面所构成的子四面体体积与总体积的比值。

梯度 $\nabla \lambda_i$ 的计算对于 Nédélec 元素的构造至关重要。利用行列式恒等式，可以导出：

$$\nabla \lambda_i = \frac{1}{3V} \mathbf{A}_i$$

其中 $\mathbf{A}_i$ 是顶点 $i$ 所对面的面积矢量（方向指向四面体内部）。这表明 $\nabla \lambda_i$ 垂直于顶点 $i$ 的对立面。这一性质不仅简化了计算，而且为理解基函数的边界行为提供了直观的几何解释 4。在 MATLAB 实现中，可以通过求解雅可比矩阵的逆矩阵批量获取所有单元的 $\nabla \lambda_i$。

### 2.2 最低阶Nedelec基函数（Whitney 1-形式）

第一类 Nédélec 空间的最简形式，通常记为 $ND_1$ 或 $N_0$，其基函数关联于四面体的 6 条棱边。对于连接顶点 $i$ 和 $j$ 的有向棱边 $e_{ij}$，其对应的矢量基函数 $\mathbf{w}_{ij}$ 定义为：

$$\mathbf{w}_{ij} = l_{ij} (\lambda_i \nabla \lambda_j - \lambda_j \nabla \lambda_i)$$

其中 $l_{ij}$ 是棱边长度（在某些归一化定义中可能被省略，取决于自由度是定义为切向投影还是切向分量）。该公式在文献中被广泛引用，是 Nédélec 元素的标准定义形式 5。

#### 2.2.1 基函数的关键性质

1. **切向连续性：** 在棱边 $e_{ij}$ 上，$\mathbf{w}_{ij}$ 的切向分量非零且为常数，而在其他棱边上的切向分量为零。更重要的是，在四面体的面上，$\mathbf{w}_{ij}$ 的切向分量仅在包含棱边 $e_{ij}$ 的两个面上非零，且方向垂直于面的法线。这种构造自然保证了跨单元界面的切向连续性。

2. 常旋度特性： 对基函数取旋度，利用矢量恒等式 $\nabla \times (f \mathbf{A}) = \nabla f \times \mathbf{A} + f \nabla \times \mathbf{A}$ 以及 $\nabla \times \nabla \lambda = 0$，可得：

   $$\nabla \times \mathbf{w}_{ij} = 2 l_{ij} (\nabla \lambda_i \times \nabla \lambda_j)$$

   由于 $\nabla \lambda$ 是常矢量，因此 $\mathbf{w}_{ij}$ 的旋度在整个单元内是常数矢量。这意味着最低阶 Nédélec 元素能够精确表示均匀磁场 12。

3. **零散度（在特定空间内）：** 虽然 Nédélec 空间包含非零散度函数，但在处理无源区问题时，其解空间逼近的是无散场。对于第一类 Nédélec 元素，其散度 $\nabla \cdot \mathbf{w}_{ij} = 0$ 并不恒成立，但在高阶形式中，可以通过子空间分解实现对无散条件的更好逼近。

### 2.3 高阶Nedelec元素与分层基

为了提高精度，需要引入高阶多项式空间。$k$ 阶第一类 Nédélec 空间 $N_k$ 定义为：

$$N_k = P_{k-1}^3 \oplus S_k$$

其中 $S_k = \{ \mathbf{p} \in P_k^3 \mid \mathbf{p}(\mathbf{x}) \cdot \mathbf{x} = 0 \}$ 是 $k$ 阶齐次多项式空间的一个子集 5。

#### 2.3.1 自由度统计

四面体单元上 $k$ 阶 Nédélec 元素的自由度总数遵循序列 $(k+1)(k+3)(k+4)/2$ 5。下表列出了前几阶的自由度分布：

| **阶数 (k)** | **总 DOFs** | **棱边 DOFs (Edge)** | **面 DOFs (Face)** | **内部 DOFs (Volume)** | **备注**          |
| ------------ | ----------- | -------------------- | ------------------ | ---------------------- | ----------------- |
| **1**        | 6           | $6 \times 1$         | 0                  | 0                      | 经典 Whitney 元素 |
| **2**        | 20          | $6 \times 2$         | $4 \times 2$       | 0                      | 引入面自由度      |
| **3**        | 45          | $6 \times 3$         | $4 \times 6$       | $1 \times 3$           | 引入体自由度      |

#### 2.3.2 分层基的构造

高阶函数通常采用分层（Hierarchical）构造，这意味着 $k$ 阶基函数集合包含 $k-1$ 阶的所有基函数。这种构造有利于 $p$-自适应算法的实现。10 提供了基于勒让德多项式的构造方法。对于棱边 $e_{ij}$ 上的高阶基函数，可以表示为：

$$ \mathbf{w}_{ij}^{(n)} = L_n(\lambda_i - \lambda_j) (\lambda_i \nabla \lambda_j - \lambda_j \nabla \lambda_i) $$

其中 $L_n$ 是定义在重心坐标上的多项式（通常与移位勒让德多项式相关）。面基函数和体基函数则涉及三个或四个重心坐标的乘积及其梯度的组合。例如，面基函数通常形式为 $\lambda_k (\lambda_i \nabla \lambda_j - \lambda_j \nabla \lambda_i)$ 的变体，用于捕捉面内的非线性切向场变化 13。

### 2.4 参考单元映射与协变Piola变换

在实际有限元实现中，通常在参考四面体 $\hat{T}$ 上定义基函数 $\hat{\mathbf{w}}$，然后通过几何映射 $F: \hat{T} \to T$ 变换到物理单元。设雅可比矩阵为 $J = \partial \mathbf{x} / \partial \hat{\mathbf{x}}$。

对于 $H(\text{curl})$ 场，标准的坐标变换（直接代换）是不适用的，因为它不能保持切向分量的连续性。必须使用 协变 Piola 变换（Covariant Piola Transformation）：

$$\mathbf{w}(\mathbf{x}) = J^{-T} \hat{\mathbf{w}}(\hat{\mathbf{x}})$$

该变换的一个关键性质是保持旋度算子的结构。变换后的旋度满足：

$$\nabla \times \mathbf{w} = \frac{1}{\det J} J (\hat{\nabla} \times \hat{\mathbf{w}})$$

这一点在 Snippet 5 和 7 中得到了确认，是实现通用网格有限元代码的核心步骤。需要特别注意的是，与 $H(\text{div})$ 元素（如 Raviart-Thomas 元素）使用的逆变 Piola 变换（Contravariant Piola Transformation, $\frac{1}{\det J} J \hat{\mathbf{u}}$）不同，协变变换不包含行列式因子 $1/\det J$，这反映了切向场与法向通量在几何变换下的不同行为。

------

## 3. MATLAB中的计算实现策略

MATLAB 作为一种解释型语言，其高效计算的核心在于“矢量化”（Vectorization）。对于有限元组装这一计算密集型任务，传统的基于单元循环（Element-wise Loop）的代码结构效率极低。本章将详细阐述如何利用 MATLAB 的数组操作特性和稀疏矩阵机制，实现高性能的 Nédélec 单元组装。

### 3.1 数据结构设计

高效的实现始于合理的数据结构。我们需要维护以下核心数组：

- **节点坐标数组 (`Nodes`)**: 大小为 $N_v \times 3$，存储所有顶点的坐标。
- **单元拓扑数组 (`Elements`)**: 大小为 $N_e \times 4$，存储每个四面体的顶点索引。
- **棱边-节点索引 (`Edges`)**: 大小为 $N_{edge} \times 2$，存储每条棱边的两个顶点索引，且必须满足 $n_1 < n_2$ 的排序约束，以定义全局方向。
- **单元-棱边索引 (`ElemEdges`)**: 大小为 $N_e \times 6$，存储每个单元对应的 6 条全局棱边索引。
- **棱边方向符号 (`EdgeSigns`)**: 大小为 $N_e \times 6$，存储 $\pm 1$。如果单元的局部棱边方向（如 $1 \to 2$）与全局棱边定义一致，则为 $+1$，否则为 $-1$。这是保证全局切向连续性的关键 4。

利用 `delaunayTriangulation` 类可以方便地生成初始网格，并通过 `edges` 方法提取唯一棱边列表，利用 `ismember` 或 `unique` 函数构建上述拓扑关系映射 15。

### 3.2 符号计算预处理与代码生成

对于高阶元素或复杂的积分公式，手动推导极其繁琐且易错。利用 MATLAB 的 Symbolic Math Toolbox 进行预计算并自动生成代码是最佳实践。

**工作流：**

1. **符号定义：** 使用 `syms` 定义参考坐标和几何参数。
2. **基函数构造：** 编写符号脚本实现 $\lambda_i \nabla \lambda_j - \lambda_j \nabla \lambda_i$ 及其高阶变体。
3. **精确积分：** 对于质量矩阵 $M_{ij} = \int \mathbf{w}_i \cdot \mathbf{w}_j$ 和刚度矩阵 $K_{ij} = \int (\nabla \times \mathbf{w}_i) \cdot (\nabla \times \mathbf{w}_j)$，在参考单元上进行符号积分 17。
4. **函数生成：** 使用 `matlabFunction` 将符号表达式转换为 MATLAB 函数句柄。
   - **关键优化：** 使用 `Vars` 参数将输入参数定义为向量形式（如 `Nodes`），而非独立的标量（$x_1, y_1, \dots$）。这不仅简化了调用接口，还允许生成的函数内部利用隐式扩展处理多个单元。
   - **稀疏优化：** 设置 `'Sparse', true` 选项。虽然单元矩阵通常是稠密的，但对于某些高阶算子或混合形式，稀疏表示能显著减少内存占用 20。

例如，生成计算 6x6 单元刚度矩阵的函数：

```Matlab
% 伪代码示例
syms x y z real
%... 定义基函数 N...
K_sym = int(curl(N).' * curl(N), x, y, z, 'Domain', Tetrahedron);
matlabFunction(K_sym, 'File', 'ElemStiffMat', 'Vars', {NodeCoords});
```

### 3.3 矢量化组装技术：`sparse` vs `accumarray`

组装全局矩阵是将所有单元的局部矩阵贡献累加到全局自由度上。在 MATLAB 中，主要有两种高效途径：

1. 基于 sparse 的三元组法：

   这是最常用的方法。首先构造三个大数组 I（行索引）、J（列索引）和 V（数值），长度均为 $36 \times N_e$（对于线性四面体）。

   ```Matlab
   I = repmat(ElemEdges, 1, 6)'; % 构造行索引矩阵并展平
   J = kron(ElemEdges, ones(1, 6))'; % 构造列索引矩阵并展平
   V = K_all(:); % 展平所有单元矩阵
   K_global = sparse(I(:), J(:), V(:), N_dof, N_dof);
   ```

   MATLAB 的 `sparse` 函数内部针对这种累加操作进行了高度优化，能够自动处理重复索引的求和 23。

2. 基于 accumarray 的方法：

   accumarray 提供了更通用的累加功能，允许用户指定累加函数。对于某些特定结构的矩阵，或者当需要进行非求和（如最大值、逻辑或）组装时，accumarray 更具优势。但在标准 FEM 组装中，sparse 通常在内存效率和速度上略胜一筹，因为它是专门为稀疏矩阵压缩存储（CSR/CSC）设计的 25。

关于 parfor 并行组装的讨论：

虽然使用 parfor 并行计算局部矩阵看起来能加速，但在实际操作中，将大量数据从 worker 传输回主线程构建稀疏矩阵往往会造成内存瓶颈。研究表明，对于中等规模网格，经过高度优化的矢量化串行代码往往比粗粒度的 parfor 循环更快。如果必须使用并行，建议在每个 worker 内部先组装成较大的子块（Sub-domain Assembly），然后再进行全局合并，而不是在循环内部频繁调用 sparse 27。

### 3.4 边界条件与方向修正

在组装过程中，必须严格处理棱边方向。局部矩阵计算通常基于局部顶点编号（1, 2, 3, 4），而全局组装基于全局顶点编号。

$$K_{global}(i, j) += K_{local}(a, b) \times \text{Sign}(e_a) \times \text{Sign}(e_b)$$

其中 $\text{Sign}(e_a)$ 来源于前述的 EdgeSigns 数组。忽略这一项将导致刚度矩阵非物理，表现为严重的数值振荡或奇异性 14。

------

## 4. 验证与确认：确保物理一致性

Nédélec 元素的实现细节繁多，极易出错。建立一套分层级的验证（Verification）流程是确保代码可信度的关键。

### 4.1 离散亥姆霍兹分解（Discrete Helmholtz Decomposition）

这是验证 $H(\text{curl})$ 空间实现正确性的“金标准”。连续理论中的 Helmholtz 分解 $V = \nabla S \oplus \mathbf{X}$ 在离散层面必须精确成立。这意味着：

离散梯度矩阵 $G$（大小为 $N_{edge} \times N_{node}$）必须能够将节点标量场精确映射到 Nédélec 空间的旋度零空间中。

验证步骤：

1. 构建离散梯度算子 $G$。$G_{ij} = \pm 1$ 当且仅当棱边 $i$ 连接节点 $j$，符号取决于棱边方向指向节点还是背离节点。
2. 计算矩阵乘积 $K \times G$，其中 $K$ 是旋度-旋度刚度矩阵。
3. **检查：** 结果必须在机器精度（$10^{-15}$ 级别）下为零矩阵。这证明了所有梯度场都被正确地识别为旋度为零的场。如果该测试失败，说明基函数的定义或棱边方向处理存在根本性错误 30。

### 4.2 刚体模态与零空间分析

在结构力学中，刚度矩阵的零空间对应于刚体位移。在电磁学中，旋度算子的“刚体模态”即为梯度场。

对于单个四面体单元（线性），其刚度矩阵大小为 $6 \times 6$。

理论预测： 四面体有 4 个顶点，其中 1 个是参考点（势能零点），因此应有 $4-1=3$ 个线性无关的梯度模式。

数值检查： 对单元刚度矩阵进行奇异值分解（SVD）或特征值分析。应观测到恰好 3 个接近零的特征值（对应梯度场）和 3 个非零正特征值（对应物理常磁场模式）。

如果零特征值少于 3 个，说明单元存在“闭锁”（Locking）现象，无法正确描述梯度场；如果多于 3 个，则存在伪零能模态（Spurious Zero Energy Modes），会导致解的不稳定 33。

### 4.3 补片测试（Patch Test）与谱分析

补片测试：

在一个由若干畸变四面体构成的立方体区域上，施加对应于线性电场 $\mathbf{E} = [y, 0, 0]^T$ 的边界条件。由于最低阶 Nédélec 空间包含线性场，数值解应能精确恢复该解析解（误差应接近机器精度）。这验证了算法的一致性（Consistency） 30。

空腔谐振器谱分析：

计算单位立方体空腔的本征值问题 $K \mathbf{x} = \lambda M \mathbf{x}$。

预期结果：

1. 大量的零特征值（数量 = 内部节点数 + 边界修正），对应离散梯度空间。
2. 非零特征值序列应逼近解析解 $\pi^2 (m^2 + n^2 + p^2)$。
3. **关键指标：** 检查是否存在位于零和第一个物理特征值之间的非物理特征值。Nédélec 元素的显著特征是其能够将所有伪模态精确地“驱赶”到零频，从而保持物理谱的纯净（Spectral Purity） 3。

### 4.4 单位一致性检查

在工程应用中，单位错误是常见但隐蔽的 bug 来源。利用 MATLAB/Simulink 的单位检查功能可以辅助验证。

Nédélec 自由度的物理意义是电动势（EMF），单位为 Volts ($V$)。

基函数 $\mathbf{w}$ 包含梯度项 $\nabla \lambda$，单位为 $m^{-1}$。

电场 $\mathbf{E} = \sum c_i \mathbf{w}_i$，单位为 $V \cdot m^{-1} = V/m$。

这种量纲分析虽然简单，但在处理包含异质材料系数 $\epsilon, \mu$ 的复杂方程时，能有效防止系数遗漏 37。

------

## 5. 结论

Nédélec 有限元方法是解决三维电磁场问题的基石，其成功依赖于深刻的数学结构（确切序列、微分形式）与精细的算法实现（矢量化、符号计算）的结合。

本报告通过拆解 Nédélec 四面体单元的构造细节，指出了传统节点元的缺陷，并给出了基于重心坐标的显式基函数公式。在实现层面，强调了 MATLAB 矢量化组装相对于循环组装的性能优势，并推荐利用 Symbolic Toolbox 自动生成高阶算子代码以降低实现难度。

最后，建立了一套包含离散 Helmholtz 分解、刚体模态分析和谱正确性测试的验证体系。这一体系不仅能够验证代码的正确性，更能帮助研究人员深入理解离散电磁场的物理本质。对于追求高精度、高效率电磁仿真的工程师和学者而言，掌握这些理论与技巧是通往高性能计算电磁学的必经之路。

## 6. 附录：关键算法代码片段示例

### 6.1 线性四面体旋度矩阵的矢量化计算核心

```Matlab
% 假设 Grads 是 (Ne x 4 x 3) 的梯度数组
% Grads(e, i, :) 存储第 e 个单元第 i 个节点的 lambda 梯度
% ElemEdges 存储局部棱边定义，例如 Edge 1 是节点 [1, 2]

% 预计算每条棱边的常数旋度向量 C_edge = 2 * (grad L_i x grad L_j)
% 维度: (Ne x 6 x 3)
C_edges = zeros(Ne, 6, 3);
local_edge_pairs = [1 2; 1 3; 1 4; 2 3; 2 4; 3 4]; % 标准顺序

for k = 1:6
    n1 = local_edge_pairs(k, 1);
    n2 = local_edge_pairs(k, 2);
    % 矢量化叉乘: cross(A, B, 2)
    grad1 = squeeze(Grads(:, n1, :));
    grad2 = squeeze(Grads(:, n2, :));
    C_edges(:, k, :) = 2 * cross(grad1, grad2, 2); 
end

% 计算单元刚度矩阵 K_local (Ne x 6 x 6)
% K_ij = (C_i. C_j) * Volume
K_local = zeros(Ne, 6, 6);
for i = 1:6
    for j = 1:6
        % 矢量化点积
        dot_prod = dot(C_edges(:, i, :), C_edges(:, j, :), 3);
        K_local(:, i, j) = dot_prod.* Volumes;
    end
end
% 此时 K_local 已经准备好进行 sparse 组装
```

此代码片段展示了如何完全避免在单元上进行循环，利用 MATLAB 的张量操作实现极高的计算吞吐量。结合前文所述的符号修正和索引映射，即可构成完整的求解器内核。